<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Bakery Focus</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FEF9E7; /* å¥¶æ²¹é»„ */
            --wood-dark: #A0522D; /* æœ¨æ£•è‰² */
            --wood-light: #CD853F; /* æµ…æœ¨è‰² */
            --window-glass: #FFFDF5; /* çª—å£èƒŒæ™¯ */
            --primary-pink: #F4C2C2;
            --deep-pink: #E91E63; /* èœå•æ ‡é¢˜ç²‰ */
            --accent-yellow: #FDFD96;
            --text-color: #5D4037; /* å’–å•¡è‰² */
            --oven-dark: #3E2723;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'DotGothic16', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            overflow: hidden; 
        }

        /* ------------------------------------------------ */
        /* 1. ç”œå“åº—å±•ç¤ºæŸœå¤–å½¢ */
        /* ------------------------------------------------ */
        .display-case {
            width: 95%;
            max-width: 480px; 
            background: var(--wood-dark);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 15px 30px rgba(93, 64, 55, 0.4), 
                        inset 0 -10px 10px rgba(0,0,0,0.3); 
            position: relative;
        }

        /* ç»ç’ƒå±•ç¤ºçª—å£ */
        .display-window {
            background: var(--window-glass);
            border: 8px solid var(--wood-light);
            border-radius: 6px;
            height: 550px; 
            overflow-y: auto; 
            overflow-x: hidden;
            position: relative;
            padding: 15px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1); 

            /* åƒç´ ç½‘æ ¼èƒŒæ™¯çº¹ç† */
            background-image: 
                linear-gradient(#FCE4EC 1px, transparent 1px),
                linear-gradient(90deg, #FCE4EC 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .display-window::-webkit-scrollbar { width: 4px; length: 5px;}
        .display-window::-webkit-scrollbar-thumb { background: var(--wood-dark); border-radius: 3px; }

        /* ------------------------------------------------ */
        /* 2. ç•Œé¢å’Œç»„ä»¶æ ·å¼ */
        /* ------------------------------------------------ */

        h1 {
            font-size: 20px;
            text-align: center;
            margin: 10px 0 20px;
            color: var(--deep-pink);
            text-shadow: 2px 2px 0px #FFF;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            background: #FFF;
            padding: 5px 10px;
            border: 2px solid var(--text-color);
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .cake-card {
            background: #FFF;
            border: 2px solid var(--text-color);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.1s;
            position: relative;
            overflow: hidden;
        }

        .cake-card:active { transform: scale(0.95); }
        
        .cake-card img {
            width: 48px;
            height: 48px;
            image-rendering: pixelated; 
            margin-bottom: 5px;
        }

        .cake-name { 
            font-size: 14px; 
            font-weight: bold; 
            margin: 5px 0; 
            font-family: 'DotGothic16', sans-serif; 
        }
        
        .cake-time { 
            font-size: 12px; 
            color: #FFF; 
            background: #E5989B; 
            display: inline-block; 
            padding: 2px 6px; 
            border-radius: 4px; 
        }

        #oven-screen { display: none; height: 100%; text-align: center; }

        /* çƒ¤ç®±/åˆ¶ä½œåŒºåŸŸ */
        .oven-body {
            background: #F5EFE6;
            border-radius: 10px;
            padding: 10px;
            margin-top: 20px;
            position: relative;
            border: 6px solid #3E2723;
        }

        .oven-window {
            background: #F4C2C2;
            height: 150px;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            border: 4px solid #5D4037;
        }

        /* çƒ¤ç®±åŠ çƒ­åŠ¨ç”»åŠè’¸æ±½ */
        .heating .oven-window { animation: ovenGlow 2s infinite alternate; }
        @keyframes ovenGlow {
            from { box-shadow: inset 0 0 10px #FFA07A; background: #3E2723; }
            to { box-shadow: inset 0 0 40px #FFCCBC; background: #5D4037; }
        }
        .steam-container { position: absolute; top: -20px; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .steam { position: absolute; background: rgba(255, 255, 255, 0.6); width: 8px; height: 8px; bottom: 10px; left: 50%; opacity: 0; }
        .steam.animate { animation: rise 2s infinite; }
        @keyframes rise {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-60px) scale(2); opacity: 0; }
        }

        .oven-timer {
            font-family: 'Press Start 2P', cursive;
            color: var(--deep-pink);
            font-size: 28px;
            margin-top: 15px;
            background: #FFF;
            padding: 12px 25px;
            border: 4px solid var(--primary-pink);
            border-radius: 15px;
            display: inline-block;
        }

        .btn-group { margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
        
        .pixel-btn {
            font-family: 'DotGothic16', sans-serif;
            background: #FFF;
            border: 2px solid var(--text-color);
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 4px 4px 0px var(--text-color);
            transition: 0.1s;
        }

        .pixel-btn:active {
            box-shadow: 0px 0px 0px;
            transform: translate(4px, 4px);
        }

        /* ------------------------------------------------ */
        /* 3. å¼¹çª— (Modal) æ ·å¼ */
        /* ------------------------------------------------ */
        .modal {
            display: none;
            position: fixed;
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 999;
            pointer-events: auto; 
        }

        /* æ¬¢è¿å¼¹çª—çš„ç‰¹æ®Šæ ·å¼å’ŒåŠ¨ç”» */
        .welcome-box {
            box-shadow: 8px 8px 0px var(--accent-yellow); 
            opacity: 0; 
            transform: scale(0.5);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
        }

        /* å…³é”® CSS ä¿®å¤ï¼šåˆå§‹æ—¶è®©å®ƒæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†é¿å…ä½¿ç”¨ !importantï¼Œè®© JS æ§åˆ¶ display */
        #welcome-modal {
            display: flex; 
        }
        
        @keyframes popIn {
            from { transform: scale(0.5) translateY(-50px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .modal-content {
            background: #FFF;
            padding: 20px;
            border: 4px solid var(--text-color);
            text-align: center;
            box-shadow: 8px 8px 0px var(--primary-pink);
            width: 80%;
            max-width: 300px;
        }
        
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div class="display-case">
        <div class="display-window">
            
            <div class="status-bar">
                <span>ğŸ° åˆè¨ˆ: <span id="total-cakes">0</span> å€‹</span>
                <span>â° æ™‚é–“: <span id="total-time">0</span> min</span>
            </div>

            <div id="menu-screen">
                <h1>â™¡ Maid Cafe Focus â™¡<br><span style="font-size:12px; color:#888;">Select Your Treat</span></h1>
                <div class="menu-grid" id="menu-grid">
                    </div>
            </div>

            <div id="oven-screen">
                <h2 id="task-title" style="margin-bottom:5px;">Strawberry Cake</h2>
                <p id="kaomoji-display" style="font-size:12px; color:#E91E63; margin-top:0;">( Ë˜Ï‰Ë˜ ) æº–å‚™ä¸­...</p>

                <div class="oven-body heating">
                    <div class="steam-container" id="steam-container">
                        </div>
                    <div class="oven-window">
                        <img id="baking-img" src="" style="width:100px; height:100px; image-rendering:pixelated;">
                    </div>
                </div>

                <div class="oven-timer" id="timer-display">25:00</div>

                <div class="btn-group">
                    <button class="pixel-btn" onclick="toggleTimer()">åœæ­¢</button>
                    <button class="pixel-btn" style="background:#FDFD96;" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>

        </div>
    </div>

    <div id="welcome-modal" class="modal">
        <div class="modal-content welcome-box">
            <h2 style="color:#E91E63;">ãŠå¸°ã‚Šï¼</h2>
            <div class="complete-img" style="animation: none;">ğŸ€</div>
            <p style="line-height: 1.6; font-size: 14px;">
                ã”ä¸»äººæ§˜ï¼<br>
                ä»Šæ—¥ã¯ã€ä½•ã«ãªã•ã„ã¾ã™ã‹ï¼Ÿ<br>
                <span style="color: #5D4037; font-size: 10px;">(UË˜ áµ• Ë˜U)</span>
            </p>
            <br>
            <button class="pixel-btn" onclick="closeWelcomeModal()">æ³¨æ–‡ã™ã‚‹</button>
        </div>
    </div>

    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:#E91E63;">Baked!</h2>
            <img id="done-img" src="" style="width:80px; height:80px; margin:10px 0; image-rendering:pixelated;">
            <p>
                <span id="done-name"></span> is Done!<br>
                <br>
                Looks delicious! (à¹‘Â´Ú¡`à¹‘)
            </p>
            <button class="pixel-btn" onclick="closeModal()">OK!</button>
        </div>
    </div>


    <script>
        // ================= å…¨å±€å˜é‡å’Œæ•°æ®é…ç½® =================
        let welcomeTimeout = null; 

        const desserts = [
            { name: "Strawberry Cake", time: 5, imgUrl: "./images/cake_strawberry_sliced.png" }, 
            { name: "Fruit Waffles", time: 10, imgUrl: "./images/BerryWaffles.png" },
            { name: "Cinnamon Roll", time: 15, imgUrl: "./images/Cinnamonroll.png" },
            { name: "Lemon Cake", time: 20, imgUrl: "./images/LemonCheesecake.png" },
            { name: "Rainbow Pancake", time: 25, imgUrl: "./images/Pancakes_Rainbow.png" },
            { name: "Croissant", time: 30, imgUrl: "./images/Croissant.png" },
            { name: "Tiramisu", time: 45, imgUrl: "./images/Tirimasu.png" },
            { name: "Cookie & Cream", time: 50, imgUrl: "./images/CookieNCreamPot.png" },
            { name: "Cheese Cake", time: 60, imgUrl: "./images/Cheesecake.png" },
            { name: "Angelic Rainbow", time: 90, imgUrl: "./images/cake_rainbow_sliced.png" }
        ];

        const kaomojis = [
            "( â€¢Ì€Tcâ€¢Ì ) ã¾ãœã¾ãœ...",
            "( Ë˜Ï‰Ë˜ ) ãµãã‚‰ã¿ä¸­...",
            "(ï½¡â€¢Ì€á´—-)âœ§ ãŠã„ã—ããªã€œã‚Œ",
            "(à¸‡ â€¢_â€¢)à¸‡ ã˜ã£ãã‚Š...",
            "(*Pxq*) ã‚¤ã‚¤åŒ‚ã„..."
        ];

        let countdown;
        let totalSeconds;
        let isPaused = false;
        let currentCake = null;
        let achievements = JSON.parse(localStorage.getItem('bakeryAchievements')) || { count: 0, time: 0 };
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        // ================= å‡½æ•°å®šä¹‰ =================

        function playBeep() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            const startTime = audioCtx.currentTime;
            const duration = 0.2
            
            oscillator.type = 'triangle'; 

            const startFreq = 1200; // æ›´é«˜çš„èµ·å§‹é¢‘ç‡
            const endFreq = 400;    // ç»“æŸé¢‘ç‡

            oscillator.frequency.setValueAtTime(startFreq, startTime); 
            oscillator.frequency.exponentialRampToValueAtTime(endFreq, startTime + duration);
            
            gainNode.gain.setValueAtTime(0.15, startTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, startTime + duration);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start(startTime);
            oscillator.stop(startTime + duration);
        }

        function init() {
            updateAchievementUI();
            
            const menuGrid = document.getElementById('menu-grid');
            
            // ç¡®ä¿èœå•åªç”Ÿæˆä¸€æ¬¡
            if (menuGrid.children.length === 0) {
                desserts.forEach(cake => {
                    const btn = document.createElement('div');
                    btn.className = 'cake-card';
                    btn.innerHTML = `
                        <img src="${cake.imgUrl}" alt="${cake.name}">
                        <div class="cake-name">${cake.name}</div>
                        <div class="cake-time">${cake.time} min</div>
                    `;
                    btn.onclick = () => {
                        playBeep();
                        startBaking(cake);
                    };
                    menuGrid.appendChild(btn);
                });
            }

            createSteam();
        }
        
        function createSteam() {
            const container = document.getElementById('steam-container');
            if(container.children.length > 0) return; 

            for(let i=0; i<5; i++) {
                let steam = document.createElement('div');
                steam.className = 'steam hidden'; 
                steam.style.left = (20 + Math.random() * 60) + '%';
                steam.style.animationDelay = (Math.random() * 2) + 's';
                container.appendChild(steam);
            }
        }

        function startBaking(cake) {
            currentCake = cake;
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('oven-screen').style.display = 'block';
            document.getElementById('task-title').innerText = cake.name;
            document.getElementById('baking-img').src = cake.imgUrl;
            totalSeconds = cake.time * 60;
            isPaused = false;
            updateDisplay();
            updateKaomoji();
            document.querySelectorAll('.steam').forEach(s => {
                s.classList.remove('hidden');
                s.classList.add('animate');
            });
            startInterval();
        }

        function startInterval() {
            clearInterval(countdown);
            countdown = setInterval(() => {
                if (!isPaused) {
                    totalSeconds--;
                    updateDisplay();
                    if (totalSeconds % 60 === 0) updateKaomoji();
                    if (totalSeconds <= 0) {
                        finishBaking();
                    }
                }
            }, 1000);
        }

        function updateDisplay() {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            document.getElementById('timer-display').innerText = 
                `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function updateKaomoji() {
            const random = Math.floor(Math.random() * kaomojis.length);
            document.getElementById('kaomoji-display').innerText = kaomojis[random];
        }

        function toggleTimer() {
            playBeep();
            isPaused = !isPaused;
            const btn = document.querySelector('#oven-screen .pixel-btn');
            const ovenWindow = document.querySelector('.oven-body');
            
            if (isPaused) {
                btn.innerText = "å†é–‹ â–¶";
                ovenWindow.classList.remove('heating'); 
                document.querySelectorAll('.steam').forEach(s => s.classList.remove('animate')); 
                document.getElementById('kaomoji-display').innerText = "( Ë™-Ë™ ) ä¼‘æ†©...";
            } else {
                btn.innerText = "ä¸€æ™‚åœæ­¢";
                ovenWindow.classList.add('heating');
                document.querySelectorAll('.steam').forEach(s => s.classList.add('animate'));
                updateKaomoji();
            }
        }

        function resetGame() {
            playBeep();
            clearInterval(countdown);
            document.getElementById('oven-screen').style.display = 'none';
            document.getElementById('menu-screen').classList.remove('hidden');
            document.querySelector('#oven-screen button').innerText = "ä¸€æ™‚åœæ­¢";
            document.querySelectorAll('.steam').forEach(s => {
                s.classList.remove('animate');
                s.classList.add('hidden');
            });
        }

        function finishBaking() {
            clearInterval(countdown);
            playBeep(); 
            achievements.count += 1;
            achievements.time += currentCake.time;
            localStorage.setItem('bakeryAchievements', JSON.stringify(achievements));
            updateAchievementUI();
            const modal = document.getElementById('completion-modal');
            document.getElementById('done-name').innerText = currentCake.name;
            document.getElementById('done-img').src = currentCake.imgUrl;
            modal.style.display = 'flex';
        }

        function closeModal() {
            playBeep();
            document.getElementById('completion-modal').style.display = 'none';
            resetGame(); 
        }


        // å…³é”®ä¿®å¤å‡½æ•°
        function closeWelcomeModal() {
            playBeep();
            
            // 1. æ¸…é™¤å®šæ—¶å™¨ï¼Œé˜²æ­¢åå¤å‡ºç°
            if (welcomeTimeout !== null) {
                clearTimeout(welcomeTimeout);
                welcomeTimeout = null; 
            }
            
            const welcomeModal = document.getElementById('welcome-modal');
            
            // 2. å¯åŠ¨æ·¡å‡ºåŠ¨ç”»
            welcomeModal.style.opacity = '0';
            welcomeModal.style.transition = 'opacity 0.3s ease';
            
            // 3. å»¶è¿Ÿåå½»åº•éšè—å¼¹çª—å¹¶å¯åŠ¨æ¸¸æˆ (æœ€å…³é”®çš„ä¸€æ­¥)
            setTimeout(() => {
                // ç¡®ä¿ display è¢«è®¾ç½®ä¸º none
                welcomeModal.style.display = 'none'; 
                // æ¢å¤ opacity ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨
                welcomeModal.style.opacity = '1'; 
                // å¯åŠ¨ä¸»åº”ç”¨é€»è¾‘ï¼ˆç”Ÿæˆèœå•ï¼‰
                init();
            }, 300); // ç­‰å¾…æ·¡å‡ºåŠ¨ç”»å®Œæˆ
        }
        
        // åº”ç”¨ç¨‹åºå¯åŠ¨å…¥å£ (åªè®¾ç½®ä¸€æ¬¡å®šæ—¶å™¨)
        function startApplication() {
            // è®¾ç½®è‡ªåŠ¨å…³é—­çš„å®šæ—¶å™¨
            welcomeTimeout = setTimeout(closeWelcomeModal, 4000); 
        }

        function updateAchievementUI() {
            document.getElementById('total-cakes').innerText = achievements.count;
            document.getElementById('total-time').innerText = achievements.time;
        }

        // å¯åŠ¨åº”ç”¨
        startApplication();

    </script>
</body>
</html>